.code
    PUSH simple_heap_init
    CALL ; Inicializa heap
    PUSH A_main ; Pushea label del main
    CALL ; Llama a main
    HALT ; Finaliza la ejecucion del programa

simple_heap_init:
    RET 0 ; Init de heap

simple_malloc:
    LOADFP ; Init unidad
    LOADSP
    STOREFP ; Fin de init
    LOADHL
    DUP
    PUSH 1 ; Principio de bloque sigue al final del heap
    ADD
    STORE 4 ; Puntero a principio de bloque
    LOAD 3 ; Cantidad de celdas a alojar
    ADD
    STOREHL ; Actualiza heap size
    STOREFP
    RET 1 ; Retorna, liberando parametro

Object_debugPrint:
    LOADFP
    LOADSP
    STOREFP
    STOREFP
    RET 1

System_read:
    LOADFP
    LOADSP
    STOREFP
    READ ; Lee tope de la pila
    STORE 3 ; Guarda en retorno el tope
    STOREFP
    RET 0

System_printB:
    LOADFP
    LOADSP
    STOREFP
    LOAD 3 ; Pone en el tope la pila el parametro
    BPRINT ; Imprime el tope de la pila
    STOREFP
    RET 1 ; Libera el parametro

System_printC:
    LOADFP
    LOADSP
    STOREFP
    LOAD 3 ; Pone en el tope la pila el parametro
    CPRINT ; Imprime el tope de la pila
    STOREFP
    RET 1 ; Libera el parametro

System_printI:
    LOADFP
    LOADSP
    STOREFP
    LOAD 3 ; Pone en el tope la pila el parametro
    IPRINT ; Imprime el tope de la pila
    STOREFP
    RET 1 ; Libera el parametro

System_printS:
    LOADFP
    LOADSP
    STOREFP
    LOAD 3 ; Pone en el tope la pila el parametro
    SPRINT ; Imprime el tope de la pila
    STOREFP
    RET 1 ; Libera el parametro

System_println:
    LOADFP
    LOADSP
    STOREFP
    PRNLN
    STOREFP
    RET 0

System_printBln:
    LOADFP
    LOADSP
    STOREFP
    LOAD 3 ; Pone en el tope la pila el parametro
    BPRINT ; Imprime el tope de la pila
    PRNLN
    STOREFP
    RET 1 ; Libera el parametro

System_printCln:
    LOADFP
    LOADSP
    STOREFP
    LOAD 3 ; Pone en el tope la pila el parametro
    CPRINT ; Imprime el tope de la pila
    PRNLN
    STOREFP
    RET 1 ; Libera el parametro

System_printIln:
    LOADFP
    LOADSP
    STOREFP
    LOAD 3 ; Pone en el tope la pila el parametro
    IPRINT ; Imprime el tope de la pila
    PRNLN
    STOREFP
    RET 1 ; Libera el parametro

System_printSln:
    LOADFP
    LOADSP
    STOREFP
    LOAD 3 ; Pone en el tope la pila el parametro
    SPRINT ; Imprime el tope de la pila
    PRNLN
    STOREFP
    RET 1 ; Libera el parametro

.code
A_main:
    LOADFP ; Guarda ED
    LOADSP ; Guarda SP
    STOREFP ; Corre FP al SP
    PUSH 5
    PUSH 10
    ADD
    PUSH System_printIln ; Direccion del metodo en tope de la pila
    CALL ; Llama al metodo
    PUSH 0
    PUSH 1
    AND
    PUSH System_printBln ; Direccion del metodo en tope de la pila
    CALL ; Llama al metodo
    PUSH 1
    PUSH 0
    PUSH 1
    OR
    AND
    PUSH System_printBln ; Direccion del metodo en tope de la pila
    CALL ; Llama al metodo
    PUSH 15
    PUSH System_printIln ; Direccion del metodo en tope de la pila
    CALL ; Llama al metodo
    PUSH 15
    NEG
    PUSH System_printIln ; Direccion del metodo en tope de la pila
    CALL ; Llama al metodo
    PUSH 1
    NOT
    PUSH System_printBln ; Direccion del metodo en tope de la pila
    CALL ; Llama al metodo
    STOREFP ; Usa ED para volver a RA llamador
    RET 0 ; Libera los parametros y retorna de la unidad
